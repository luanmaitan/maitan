---
import Layout from "../layouts/Layout.astro";

const portfolioItems = [
    // Livros (Vertical - Aspect 2/3)
    {
        title: "Coleção Clássicos",
        category: "livro",
        role: "edição",
        image: "/portfolio/livro-1.jpg", // Placeholder path
        aspect: "vertical",
    },
    {
        title: "Romance Contemporâneo",
        category: "livro",
        role: "revisão",
        image: "/portfolio/livro-2.jpg",
        aspect: "vertical",
    },
    // Revistas (Vertical or Square depending on design, let's use Vertical for consistency with print)
    {
        title: "Revista Acadêmica #42",
        category: "revista",
        role: "coordenação",
        image: "/portfolio/revista-1.jpg",
        aspect: "vertical",
    },
    // Web (Horizontal - Aspect Video)
    {
        title: "Portal de Notícias",
        category: "web",
        role: "webdesign",
        image: "/portfolio/web-1.jpg",
        aspect: "horizontal",
    },
    {
        title: "Landing Page Institucional",
        category: "web",
        role: "desenvolvimento",
        image: "/portfolio/web-2.jpg",
        aspect: "horizontal",
    },
    // Vídeo (Horizontal)
    {
        title: "Documentário Curta",
        category: "vídeo",
        role: "edição de vídeo",
        image: "/portfolio/video-1.jpg",
        aspect: "horizontal",
    },
    // Design (Square or Variable, let's try Square for visual variety)
    {
        title: "Identidade Visual",
        category: "design",
        role: "design gráfico",
        image: "/portfolio/design-1.jpg",
        aspect: "square",
    },
    // Áudio (Square - Album art style)
    {
        title: "Podcast Episódio 1",
        category: "áudio",
        role: "tratamento de áudio",
        image: "/portfolio/audio-1.jpg",
        aspect: "square",
    },
];

const productFilters = ["livro", "revista", "web", "vídeo", "áudio", "design"];

const roleFilters = [
    "edição",
    "revisão",
    "coordenação",
    "webdesign",
    "desenvolvimento",
    "design gráfico",
];

// Helper to get aspect ratio classes
const getAspectClass = (aspect: string) => {
    switch (aspect) {
        case "vertical":
            return "aspect-[2/3]";
        case "horizontal":
            return "aspect-video";
        case "square":
            return "aspect-square";
        default:
            return "aspect-square";
    }
};

// Calculate counts
const productCounts: Record<string, number> = {};
const roleCounts: Record<string, number> = {};

portfolioItems.forEach((item) => {
    productCounts[item.category] = (productCounts[item.category] || 0) + 1;
    roleCounts[item.role] = (roleCounts[item.role] || 0) + 1;
});
---

<Layout title="Maitan Hub | Portfólio" fullWidth={true}>
    <!-- Sidebar removed -->

    <section class="space-y-12">
        <header>
            <h1
                class="text-[60px] leading-[0.95] tracking-tighter font-black text-black dark:text-white mb-4 lowercase"
            >
                portfólio
            </h1>

            <!-- Filters (Main Content) -->
            <div class="flex flex-col gap-2">
                <!-- Product Filters -->
                <div class="flex flex-wrap items-baseline gap-x-4 gap-y-2">
                    <span
                        class="text-[11px] font-medium text-neutral-400 dark:text-neutral-600 uppercase tracking-wider mr-2"
                        >tipo</span
                    >
                    <a
                        href="#"
                        data-filter="all"
                        data-type="category"
                        class="filter-btn text-[13px] text-black dark:text-white font-medium transition-colors lowercase whitespace-nowrap"
                    >
                        todos
                    </a>
                    {
                        productFilters.map((filter) => (
                            <a
                                href={`#${filter}`}
                                data-filter={filter}
                                data-type="category"
                                class="filter-btn group relative flex items-start text-[13px] text-neutral-500 hover:text-black dark:text-neutral-400 dark:hover:text-white transition-colors lowercase whitespace-nowrap"
                            >
                                {filter}
                                <span class="text-[9px] text-neutral-300 dark:text-neutral-600 ml-0.5 -mt-0.5">
                                    {String(
                                        productCounts[filter] || 0,
                                    ).padStart(2, "0")}
                                </span>
                            </a>
                        ))
                    }
                </div>

                <!-- Role Filters -->
                <div class="flex flex-wrap items-baseline gap-x-4 gap-y-2">
                    <span
                        class="text-[11px] font-medium text-neutral-400 dark:text-neutral-600 uppercase tracking-wider mr-2"
                        >trabalho</span
                    >
                    <a
                        href="#"
                        data-filter="all"
                        data-type="role"
                        class="filter-btn text-[13px] text-neutral-500 hover:text-black dark:text-neutral-400 dark:hover:text-white transition-colors lowercase whitespace-nowrap"
                    >
                        todos
                    </a>
                    {
                        roleFilters.map((filter) => (
                            <a
                                href={`#${filter}`}
                                data-filter={filter}
                                data-type="role"
                                class="filter-btn group relative flex items-start text-[13px] text-neutral-500 hover:text-black dark:text-neutral-400 dark:hover:text-white transition-colors lowercase whitespace-nowrap"
                            >
                                {filter}
                                <span class="text-[9px] text-neutral-300 dark:text-neutral-600 ml-0.5 -mt-0.5">
                                    {String(roleCounts[filter] || 0).padStart(
                                        2,
                                        "0",
                                    )}
                                </span>
                            </a>
                        ))
                    }
                </div>
            </div>
        </header>

        <!-- Masonry Grid Wrapper -->
        <div class="masonry-grid" id="portfolio-grid">
            {
                portfolioItems.map((item) => (
                    <div
                        class="masonry-item mb-8 break-inside-avoid"
                        data-category={item.category}
                        data-role={item.role}
                    >
                        <div class="group cursor-pointer">
                            <div
                                class={`w-full bg-neutral-100 dark:bg-neutral-800 rounded-none mb-3 overflow-hidden relative border border-neutral-200 dark:border-neutral-800 ${getAspectClass(item.aspect)}`}
                            >
                                <div class="absolute inset-0 flex items-center justify-center text-neutral-400 dark:text-neutral-600 italic">
                                    {/* Placeholder for missing image */}
                                    {item.title}
                                </div>
                                {/* Uncomment when real images are available */}
                                {/* <img src={item.image} alt={item.title} class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" loading="lazy" /> */}
                            </div>
                            <h3 class="text-[16px] font-bold text-neutral-900 dark:text-neutral-100 lowercase leading-tight group-hover:text-redo-orange transition-colors tracking-tight">
                                {" "}
                                {item.title}
                            </h3>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-xs text-neutral-500 dark:text-neutral-400 lowercase">
                                    {item.category}
                                </span>
                                <span class="text-neutral-300 dark:text-neutral-700">
                                    •
                                </span>
                                <span class="text-xs text-neutral-500 dark:text-neutral-400 lowercase">
                                    {item.role}
                                </span>
                            </div>
                        </div>
                    </div>
                ))
            }
        </div>

        <div
            id="no-results-msg"
            class="hidden text-center py-12 text-neutral-500 dark:text-neutral-400 italic"
        >
            nenhum projeto encontrado com essa combinação de filtros.
        </div>
    </section>
</Layout>

<style>
    .masonry-grid {
        column-count: 1;
        column-gap: 2rem;
    }
    @media (min-width: 640px) {
        .masonry-grid {
            column-count: 2;
        }
    }
    @media (min-width: 1024px) {
        .masonry-grid {
            column-count: 3;
        }
    }
    @media (min-width: 1280px) {
        .masonry-grid {
            column-count: 4;
        }
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const filterBtns = document.querySelectorAll(".filter-btn");
        const items = document.querySelectorAll(".masonry-item");
        const noResultsMsg = document.getElementById("no-results-msg");

        let activeCategory = "all";
        let activeRole = "all";

        function applyFilters() {
            let visibleCount = 0;

            items.forEach((item) => {
                const htmlItem = item as HTMLElement;
                const itemCategory = htmlItem.getAttribute("data-category");
                const itemRole = htmlItem.getAttribute("data-role");

                const categoryMatch =
                    activeCategory === "all" || itemCategory === activeCategory;
                const roleMatch =
                    activeRole === "all" || itemRole === activeRole;

                if (categoryMatch && roleMatch) {
                    htmlItem.style.display = "block";
                    visibleCount++;
                } else {
                    htmlItem.style.display = "none";
                }
            });

            // Show/Hide No Results Message
            if (noResultsMsg) {
                if (visibleCount === 0) {
                    noResultsMsg.classList.remove("hidden");
                } else {
                    noResultsMsg.classList.add("hidden");
                }
            }

            updateButtonStates();
            updateURL();
        }

        function updateButtonStates() {
            filterBtns.forEach((btn) => {
                const htmlBtn = btn as HTMLElement;
                const btnFilter = htmlBtn.getAttribute("data-filter");
                const btnType = htmlBtn.getAttribute("data-type");

                let isActive = false;
                if (btnType === "category") {
                    isActive = btnFilter === activeCategory;
                } else if (btnType === "role") {
                    isActive = btnFilter === activeRole;
                }

                if (isActive) {
                    htmlBtn.classList.remove(
                        "text-neutral-500",
                        "dark:text-neutral-400",
                        "hover:text-black",
                        "dark:hover:text-white",
                    );
                    htmlBtn.classList.add(
                        "text-black",
                        "dark:text-white",
                        "font-medium",
                    );
                } else {
                    htmlBtn.classList.add(
                        "text-neutral-500",
                        "dark:text-neutral-400",
                        "hover:text-black",
                        "dark:hover:text-white",
                    );
                    htmlBtn.classList.remove(
                        "text-black",
                        "dark:text-white",
                        "font-medium",
                    );
                }
            });
        }

        function updateURL() {
            const url = new URL(window.location.href);

            if (activeCategory === "all") {
                url.searchParams.delete("category");
            } else {
                url.searchParams.set("category", activeCategory);
            }

            if (activeRole === "all") {
                url.searchParams.delete("role");
            } else {
                url.searchParams.set("role", activeRole);
            }

            // Clear hash if we are using search params now to avoid confusion
            url.hash = "";

            history.replaceState(null, "", url.toString());
        }

        filterBtns.forEach((btn) => {
            btn.addEventListener("click", (e) => {
                e.preventDefault();
                const target = e.currentTarget as HTMLElement;
                const filter = target.getAttribute("data-filter");
                const type = target.getAttribute("data-type");

                if (type === "category") {
                    activeCategory = filter;
                } else if (type === "role") {
                    activeRole = filter;
                }

                applyFilters();
            });
        });

        // Initialize from URL params
        const urlParams = new URLSearchParams(window.location.search);
        const categoryParam = urlParams.get("category");
        const roleParam = urlParams.get("role");

        // Also check hash for backward compatibility or direct links
        const hash = window.location.hash.slice(1);

        if (categoryParam) activeCategory = categoryParam;
        if (roleParam) activeRole = roleParam;

        // Fallback to hash if no params but hash exists (simple single filter)
        if (!categoryParam && !roleParam && hash) {
            const decodedHash = decodeURIComponent(hash);
            // Try to guess type based on buttons
            const matchingBtn = document.querySelector(
                `.filter-btn[data-filter="${decodedHash}"]`,
            );
            const type = matchingBtn
                ? matchingBtn.getAttribute("data-type")
                : null;

            if (type === "category") activeCategory = decodedHash;
            if (type === "role") activeRole = decodedHash;
        }

        applyFilters();
    });
</script>
